<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sketch Maze – Base Prototype</title>
  <style>
    :root{
      --ink:#2b2b2b;
      --paper:#f7f4ee;
      --accent:#9bb7ff;
      --haze:rgba(120,120,120,.35);
    }
    html,body{overflow: hidden;margin:0;padding:0;background:var(--paper);color:var(--ink);font-family:ui-monospace, Menlo, Consolas, monospace;}
    #game{width:100vw; border-bottom:2px dashed var(--ink);}    
    @keyframes glow{50%{box-shadow:0 0 18px 6px rgba(155,183,255,.8)}}

canvas { display:block; }
    @keyframes jump{
      0%{transform:translateY(0)}
      50%{transform:translateY(-90px)}
      100%{transform:translateY(0)}
    } 

    #ui{
  position:fixed;
  top:8px;
  left:8px;
  z-index:10;
}    
    #basket{border:3px solid var(--ink); padding:6px 10px;}    
    #basket { width: fit-content; }

    #overlay{position:absolute; inset:0; background:rgba(247,244,238,.95); display:none;}    
    #map{margin:20px auto; width:90%; height:60%; border:3px solid var(--ink); position:relative;}    
    .map-node{position:absolute; width:120px; height:60px; border:3px dashed var(--ink); text-align:center; line-height:60px;}    
    .locked{opacity:.35;}

    .note{padding:10px; font-size:14px;}
  </style>
</head>
<body>
  <div id="ui">
    <div id="basket">Inventory: <span id="inv">(empty)</span></div>
  </div>

  <canvas id="game" width="800" height="400"></canvas>

      <!-- Player -->
    </div>
    </div>

    <!-- Map Overlay -->
    <div id="overlay">
      <div id="map">
        <div class="map-node" style="left:40px; top:40px">Orchard</div>
        <div class="map-node" style="left:220px; top:40px">Path I</div>
        <div class="map-node locked" style="left:400px; top:40px">Path II</div>
        <div class="map-node locked" style="left:580px; top:40px">Path III</div>
      </div>
    </div>
  </div>

<script>
/* debug base canvas errors
window.onerror = (msg, src, line) => {
  alert(`JS Error:\n${msg}\nLine: ${line}`);
};

/* ======================================================
   CANVAS + CONTEXT
   ====================================================== */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

/* ======================================================
   WORLD CONSTANTS
   ====================================================== */
const groundY = 300;

/* ======================================================
   INPUT
   ====================================================== */
const keys = { left:false, right:false, up:false, down:false, space:false };

window.addEventListener("keydown", e => {
  if (["ArrowLeft","ArrowRight","ArrowUp","ArrowDown"," "].includes(e.key)) {
    e.preventDefault();
  }
  if (e.key==="ArrowLeft") keys.left=true;
  if (e.key==="ArrowRight") keys.right=true;
  if (e.key==="ArrowUp") keys.up=true;
  if (e.key==="ArrowDown") keys.down=true;
  if (e.key===" ") keys.space=true;
});

window.addEventListener("keyup", e => {
  if (e.key==="ArrowLeft") keys.left=false;
  if (e.key==="ArrowRight") keys.right=false;
  if (e.key==="ArrowUp") keys.up=false;
  if (e.key==="ArrowDown") keys.down=false;
  if (e.key===" ") keys.space=false;
});

/* ======================================================
   CAMERA
   ====================================================== */
let cameraX = 0;
const camera = { topDown:false, locked:false };

/* ======================================================
   PLAYER
   ====================================================== */
const player = {
  x: 120,
  y: 0,               // height above ground
  width: 40,
  height: 54,
  speed: 3,
  jumping: false,
  vy: 0
};

/* ======================================================
   FROG NPC
   ====================================================== */
const frog = {
  x: 820,
  y: 0,
  width: 48,
  height: 36,
  bob: 0
};
let frogTalked = false;
let frogActive = false;
let frogHatTip = 0; // animation timer

/* ======================================================
   PLATFORM (anchored from ground)
   ====================================================== */
const platforms = [
  {
    x: 560,
    heightAboveGround: 48,
    width: 120,
    thickness: 14
  }
];

/* ======================================================
   ATMOSPHERE
   ====================================================== */
const fog = {
  x: 0,
  speed: 0.015,
  height: 180
};

const crows = [
  { x: 780, y: 60, speed: 0.25 },
  { x: 620, y: 90, speed: 0.18 }
];

// hay positions (generated ONCE)
const hay = Array.from({length: 90}, () => ({
  x: Math.random()*canvas.width,
  y: groundY + 6 + Math.random()*10,
  h: 4 + Math.random()*6
}));

/* ======================================================
   INPUT HANDLING
   ====================================================== */
function handleInput(){
  if (!camera.topDown) {
    if (keys.left) player.x -= player.speed;
    if (keys.right) player.x += player.speed;
    if (keys.up && !player.jumping) {
      player.jumping = true;
      player.vy = 12;
    }
  }

  if (keys.space && !camera.locked) {
    camera.topDown = !camera.topDown;
    camera.locked = true;
  }
  if (!keys.space) camera.locked = false;
}

/* ======================================================
   PHYSICS
   ====================================================== */
function applyPhysics(){
  // gravity
  player.y += player.vy;
  player.vy -= 0.8;

  // ground collision
  if (player.y <= 0) {
    player.y = 0;
    player.jumping = false;
    player.vy = 0;
  }

  // platform collision
  platforms.forEach(p => {
  const platformTop = p.heightAboveGround;

  const playerBottom = player.y;

  if (
    player.x + player.width > p.x &&
    player.x < p.x + p.width &&
    playerBottom <= platformTop &&
    playerBottom >= platformTop - 14 &&
    player.vy <= 0
  ) {
    player.y = platformTop;
    player.vy = 0;
    player.jumping = false;
  }
});

  frog.bob += 0.04;
  if (frogHatTip > 0) frogHatTip--;
}

/* ======================================================
   DRAW HELPERS
   ====================================================== */
function roundRect(ctx,x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.lineTo(x+w-r,y);
  ctx.quadraticCurveTo(x+w,y,x+w,y+r);
  ctx.lineTo(x+w,y+h-r);
  ctx.quadraticCurveTo(x+w,y+h,x+w-r,y+h);
  ctx.lineTo(x+r,y+h);
  ctx.quadraticCurveTo(x,y+h,x,y+h-r);
  ctx.lineTo(x,y+r);
  ctx.quadraticCurveTo(x,y,x+r,y);
  ctx.closePath();
}

// draw apple trees
function drawAppleTree(x, camX){
  const tx = x - camX;

  // trunk
  ctx.fillStyle="#6b4026";
  ctx.fillRect(tx-12, groundY-96, 24, 96);

// bark lines
ctx.strokeStyle="rgba(40,20,10,0.25)";
ctx.beginPath();
ctx.moveTo(tx-6, groundY-20);
ctx.lineTo(tx-6, groundY-80);
ctx.stroke();

  // canopy
  ctx.fillStyle="#5a6f3a";
  ctx.beginPath();
  ctx.arc(tx, groundY-110, 50, 0, Math.PI*2);
  ctx.fill();

  // apples
  ctx.fillStyle="#8b2e2a"; // maroon apple
  for(let i=0;i<4;i++){
    const ax = tx + Math.cos(i*1.7)*30;
    const ay = groundY-110 + Math.sin(i*1.3)*20;
    ctx.beginPath();
    ctx.arc(ax, ay, 6, 0, Math.PI*2);
    ctx.fill();
  }

// apples in apple try highlight
ctx.fillStyle="rgba(255,220,200,0.4)";
ctx.beginPath();
ctx.arc(ax-2, ay-2, 2, 0, Math.PI*2);
ctx.fill();
}

/* ======================================================
   DRAW
   ====================================================== */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  const camX = cameraX;

  /* SKY */
const sky = ctx.createLinearGradient(0, 0, 0, groundY);
sky.addColorStop(0, "#f6d2a2");   // pale amber
sky.addColorStop(0.35, "#e0b37a"); // warm copper
sky.addColorStop(0.65, "#c18b55"); // orchard haze
sky.addColorStop(1, "#8f6b45");    // deep horizon

ctx.fillStyle = sky;
ctx.fillRect(0, 0, canvas.width, groundY);

// light shafts
ctx.fillStyle = "rgba(255,220,170,0.06)";
for (let i = 0; i < 5; i++) {
  ctx.fillRect(120 + i*140 - cameraX*0.15, 0, 60, groundY);
}

  /* FOG */
// ??? maybe delete except for one line for distand fog layer ?
  // distant fog layer
  ctx.fillStyle = "rgba(255,245,230,0.08)";
  

/* DISTANT TREES */
for (let i = 0; i < 9; i++) {
  const tx = i * 220 - (cameraX * 0.3);
  const radius = 70 + Math.sin(i * 1.3) * 18;
  const ty = groundY - 120 + Math.sin(i * 0.9) * 10;

  ctx.fillStyle = "rgba(70,85,55,0.35)";
  ctx.beginPath();
  ctx.arc(tx, ty, radius, 0, Math.PI * 2);
  ctx.fill();
}

  /* CROWS */
  ctx.strokeStyle = "#3b2f28";
  crows.forEach(c=>{
    c.x -= c.speed;
    if (c.x < -20) c.x = canvas.width+20;
    ctx.beginPath();
    ctx.moveTo(c.x-cameraX,c.y);
    ctx.lineTo(c.x-cameraX+8,c.y+4);
    ctx.lineTo(c.x-cameraX+16,c.y);
    ctx.stroke();
  });

  /* GROUND */
  ctx.fillStyle = "#6b7046";
  ctx.fillRect(-camX, groundY, canvas.width+camX, canvas.height-groundY);
// subtle ground texture
ctx.strokeStyle = "rgba(80,60,30,0.08)";
for (let i = 0; i < canvas.width; i += 24) {
  ctx.beginPath();
  ctx.moveTo(i - camX % 24, groundY + 2);
  ctx.lineTo(i - camX % 24 + 12, groundY + 8);

  ctx.stroke();
}

  /* HAY */
  ctx.fillStyle = "rgba(210,180,120,0.35)";
  hay.forEach(h=>{
    ctx.fillRect(h.x - camX, h.y, 2, h.h);
  });

// soil speckle
ctx.fillStyle="rgba(80,60,30,0.12)";
for(let i=0;i<80;i++){
  ctx.fillRect(
    Math.random()*canvas.width,
    groundY + Math.random()*30,
    1,1
  );
}

// hay bale
ctx.fillStyle="#caa76b";
roundRect(ctx, 360 - camX, groundY - 32, 44, 32, 6);
ctx.fill();

ctx.strokeStyle="rgba(120,80,40,0.4)";
ctx.beginPath();
ctx.moveTo(360-camX, groundY-18);
ctx.lineTo(404-camX, groundY-18);
ctx.stroke();

/* LOW GROUND FOG */
fog.x += fog.speed * 0.6;

const lowFog = ctx.createLinearGradient(
  -200 + fog.x, 0,
  400 + fog.x, 0
);
lowFog.addColorStop(0, "rgba(240,230,210,0.05)");
lowFog.addColorStop(0.5, "rgba(240,230,210,0.18)");
lowFog.addColorStop(1, "rgba(240,230,210,0.05)");

ctx.fillStyle = lowFog;
ctx.fillRect(0, groundY - 24, canvas.width, 36);

/* PLATFORM */
platforms.forEach(p=>{
  const px = p.x - camX;
  const py = groundY - p.heightAboveGround;

  const wood = ctx.createLinearGradient(px,py,px,py+p.thickness);
  wood.addColorStop(0,"#c89a5a");
  wood.addColorStop(1,"#8a5a2e");

  ctx.fillStyle = wood;
  ctx.fillRect(px, py, p.width, p.thickness);

  // wood knots
  ctx.fillStyle="rgba(80,50,30,0.35)";
  ctx.beginPath();
  ctx.arc(px+24, py+7, 3, 0, Math.PI*2);
  ctx.arc(px+78, py+9, 2.5, 0, Math.PI*2);
  ctx.fill();
});

// call draw apple tree 2x
drawAppleTree(220, camX);
drawAppleTree(980, camX);

/* FROG */
const fx = frog.x - camX;
const fy = groundY - frog.height + Math.sin(frog.bob)*2;

// frog shadow
ctx.fillStyle="rgba(40,30,20,0.25)";
ctx.beginPath();
ctx.ellipse(fx + frog.width/2, groundY + 4, 20, 6, 0, 0, Math.PI*2);
ctx.fill();

// body
ctx.fillStyle="#6f8f6a";
roundRect(ctx, fx, fy, frog.width, frog.height, 10);
ctx.fill();

// outline body
ctx.strokeStyle = "rgba(40,30,20,0.6)";
ctx.lineWidth = 1.5;
ctx.stroke();

// eyes
ctx.fillStyle="#fff";
ctx.beginPath();
ctx.arc(fx+14, fy+10, 4, 0, Math.PI*2);
ctx.arc(fx+34, fy+10, 4, 0, Math.PI*2);
ctx.fill();

ctx.fillStyle="#2b2b2b";
ctx.beginPath();
ctx.arc(fx+14, fy+11, 2, 0, Math.PI*2);
ctx.arc(fx+34, fy+11, 2, 0, Math.PI*2);
ctx.fill();

// top hat
ctx.fillStyle="#2a2320";
const hatLift = frogHatTip > 0 ? Math.sin(frogHatTip * 0.2) * 6 : 0;

ctx.fillRect(fx+10, fy-14 - hatLift, 28, 6);
ctx.fillRect(fx+16, fy-28 - hatLift, 16, 14);


// cane
ctx.strokeStyle="#6b3f2a";
ctx.lineWidth=3;
ctx.beginPath();
ctx.moveTo(fx+frog.width+4, fy+8);
ctx.lineTo(fx+frog.width+4, fy+frog.height+12);
ctx.stroke();

if (frogActive) {
  const bubbleY = fy - 96; // ← lift bubble above hat

  ctx.fillStyle = "rgba(255,255,248,0.95)";
  roundRect(ctx, fx - 24, bubbleY, 190, 48, 10);
  ctx.fill();

  ctx.strokeStyle = "#2b2b2b";
  ctx.stroke();

  ctx.fillStyle = "#2b2b2b";
  ctx.font = "12px ui-monospace";
  ctx.fillText("Ah. You found the apple.", fx - 12, bubbleY + 18);
  ctx.fillText("Paths open with care.", fx - 12, bubbleY + 34);
}

/* PLAYER */
const px = player.x - camX;
const py = groundY - player.height - player.y;

// shadow
ctx.fillStyle = "rgba(60,40,20,0.18)";
ctx.beginPath();
ctx.ellipse(px + player.width/2, groundY + 5, 18, 6, 0, 0, Math.PI*2);
ctx.fill();

// body
ctx.fillStyle = "#7a78b8";
roundRect(ctx, px, py, player.width, player.height, 8);
ctx.fill();

// outline body
ctx.strokeStyle = "rgba(40,30,20,0.6)";
ctx.lineWidth = 1.5;
ctx.stroke();

// eyes
ctx.fillStyle = "#ffffff";
ctx.beginPath();
ctx.arc(px + 12, py + 16, 3, 0, Math.PI*2);
ctx.arc(px + 28, py + 16, 3, 0, Math.PI*2);
ctx.fill();

ctx.fillStyle = "#2b2b2b";
ctx.beginPath();
ctx.arc(px + 12, py + 17, 1.5, 0, Math.PI*2);
ctx.arc(px + 28, py + 17, 1.5, 0, Math.PI*2);
ctx.fill();

  /* TOP DOWN MAP */
if (camera.topDown) {
  ctx.fillStyle="rgba(245,245,240,0.96)";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#2b2b2b";
  ctx.font="16px ui-monospace";
  ctx.fillText("Orchard → Paths",120,120);
  return; // ← CRITICAL
  }
}

/* ======================================================
   MAIN LOOP
   ====================================================== */
function update(){
  handleInput();
  applyPhysics();

  // --- FROG INTERACTION (per-frame, correct place) ---
  const frogCenterX = frog.x + frog.width / 2;
  const playerCenterX = player.x + player.width / 2;

  const nearFrog =
    Math.abs(playerCenterX - frogCenterX) < 70 &&
    player.y < 6;

  if (nearFrog && keys.down && !frogActive) {
    frogActive = true;
    frogHatTip = 30;
  }

  draw();

  const targetCam = player.x - canvas.width*0.4;
  cameraX += (targetCam - cameraX)*0.08;
  if (cameraX<0) cameraX=0;

  requestAnimationFrame(update);
}

update();
</script>

</body>
</html>

---

## Added NPC: Frog Guide (Top Hat)

### Visual Style
- Hand-drawn sketch aesthetic
- Slightly oversized head, long limbs
- Wears a small **top hat**
- Carries a **walking stick** (later doubles as bass bow reference)
- Idle animation: gentle sway, occasional blink

### Location
- Appears in **Path One**, shortly after entering from orchard
- Stands near a mild obstacle (rock / stump)

### Interaction
- Mouse click or ↓ + interact range
- Dialogue appears in sketch-style speech bubble

### Dialogue (Initial)
> "Ah. You found *the* apple, didn’t you?"

> "Paths open when things are carried with care."

> "I seem to have misplaced my bass… perhaps it wandered ahead of me."

### Function
- Acts as:
  - Narrative anchor
  - Soft hint system
  - Side quest giver

### Side Quest Hook
- **Quest:** Help Frog find their stand-up bass
- Bass appears later in maze (different zone)
- Returning bass unlocks:
  - New traversal ability OR
  - Hidden shortcut OR
  - Decorative musical moment

### Multiplayer-Future Ready
- Frog dialogue can change depending on:
  - Which player interacted first
  - Whether both players are present
- Frog acknowledges shared progress subtly

---

